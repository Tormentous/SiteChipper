<!DOCTYPE html>
<html lang="en">
<head>
	<link rel="icon" href="/img/favicon3.ico" type="image/x-icon">
    <meta charset="UTF-8">
    <title>Planet Coolbrador</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .discover-boards-section { margin: 2rem 0; }
        .discover-boards-horizontal {
            display: flex;
            gap: 1.5rem;
            overflow-x: auto;
            padding: 1rem 0;
            scrollbar-width: thin;
            width: 100%;
        }
        .board-card {
            display: flex;
            align-items: center;
            gap: 16px;
            text-decoration: none;
            color: #333;
            padding: 16px;
            border: 2px solid #ddd;
            border-radius: 20px;
            background: transparent;
            min-width: 240px;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        .board-card:hover {
            border-color: #999;
            background: #f8f9fa;
        }
        .icon-button {
            width: 72px;
            height: 72px;
            border: none;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
        }
        .icon-button img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }
        .board-card:hover .icon-button img {
            transform: scale(1.1);
        }
        .board-card span {
            font-weight: 600;
            font-size: 1.5rem;
        }
    </style>
</head>
<body>
    <div id="shared-header"></div>
    <div class="banner">
        <button class="downloadbutton"><a href="https://github.com/SillyBilly10/game" target="_blank">Buy Chipper on Steam!</a></button>
        <button class="downloadbutton"><a href="https://www.roblox.com/communities/323609233/Coolbrador#!/about" target="_blank">Join our group!</a></button>
    </div>
    <section class="bodytext-section container">
        <h1 class="section-header">You have landed on Planet Chipper!</h1>
        <p>Enjoy your stay</p>
    </section>
    <section class="container discover-boards-section">
        <h2 class="section-header">Discover Boards</h2>
        <div class="discover-boards-horizontal" id="discoverBoards">
            <p style="padding: 2rem; color:#888;">Loading boards...</p>
        </div>
    </section>
    <div id="shared-footer"></div>

<script>
function updateUserSection() {
  const loggedIn = localStorage.getItem("loggedIn") === "true";
  const userId = localStorage.getItem("currentUserId");

  if (loggedIn && userId) {
    const user = JSON.parse(localStorage.getItem(`user_${userId}`)) || {};
    const pfp = user.profilePicture || "/users/default/pfp.jpg";
    const username = user.username || "User";

    // Desktop
    const desk = document.getElementById("userSection");
    if (desk) {
      desk.innerHTML = `
        <a href="/users/${userId}/profile.html" style="display:flex;align-items:center;gap:10px;color:white;text-decoration:none;">
          <img src="${pfp}" style="width:40px;height:40px;border-radius:50%;object-fit:cover;">
          <span style="font-weight:bold;">${username}</span>
        </a>`;
    }

    // Mobile – this line was missing!
    const mob = document.getElementById("userSectionMobile");
    if (mob) {
      mob.innerHTML = `
        <a href="/users/${userId}/profile.html">
          <img src="${pfp}" alt="${username}" style="width:40px;height:40px;border-radius:50%;object-fit:cover;">
        </a>`;
    }
  } else {
    // Not logged in – update both
    ["userSection", "userSectionMobile"].forEach(id => {
      const el = document.getElementById(id);
      if (el) el.innerHTML = `<a href="/login.html" style="color:#4a9eff;font-weight:bold;">Login</a>`;
    });
  }
}

// Run on load and when header is injected
document.addEventListener("DOMContentLoaded", updateUserSection);
window.addEventListener("storage", updateUserSection); // sync across tabs

document.addEventListener("DOMContentLoaded", () => {
  // Load header + update profile picture right after
  fetch("../shared/header.html")
    .then(r => r.text())
    .then(h => {
      document.getElementById("shared-header").innerHTML = h;
      updateUserSection();  // ← This fixes it every time
    });

  fetch("../shared/footer.html")
    .then(r => r.text())
    .then(f => document.getElementById("shared-footer").innerHTML = f);

  // Discover boards from localStorage
  const container = document.getElementById("discoverBoards");
  let boards = [];

  for (let i = 0; i < localStorage.length; i++) {
    const key = localStorage.key(i);
    if (key.startsWith('posts_/b/')) {
      boards.push(key.replace('posts_/b/', ''));
    }
  }

  boards = [...new Set(boards)].sort();

  if (boards.length === 0) {
    container.innerHTML = '<p style="padding: 2rem; color:#888;">No boards yet. Create the first post!</p>';
    return;
  }

  container.innerHTML = boards.map(board => {
    const name = board.charAt(0).toUpperCase() + board.slice(1);
    return `
      <a href="/b/${board}/board.html" class="board-card">
        <div class="icon-button">
          <img src="/b/${board}/icon.png" 
               onerror="this.onerror=null; this.src='/icon.png'" 
               alt="${name}">
        </div>
        <span>${name}</span>
      </a>`;
  }).join("");
});
</script>
</body>
</html>
